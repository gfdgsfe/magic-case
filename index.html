<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>StarCase Mint</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #05070a; color: white; font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 0; overflow-x: hidden; }
        
        /* –°—Ç–∏–ª–∏ –ú–µ–Ω—é */
        .case-item { background: linear-gradient(180deg, #161b22 0%, #0d1117 100%); border: 1px solid #30363d; border-radius: 16px; margin-bottom: 12px; transition: 0.2s; cursor: pointer; }
        .case-item:active { transform: scale(0.98); background: #1c2128; }

        /* –†—É–ª–µ—Ç–∫–∞ (Mint Engine) */
        #roulette-overlay { display: none; position: fixed; inset: 0; background: #05070a; z-index: 999; }
        .window { position: relative; width: 100%; height: 160px; background: #0d1117; overflow: hidden; border-top: 2px solid #30363d; border-bottom: 2px solid #30363d; margin-top: 30%; }
        .pointer { position: absolute; top: 0; bottom: 0; left: 50%; width: 2px; background: #fbbf24; z-index: 10; transform: translateX(-50%); box-shadow: 0 0 15px #fbbf24; }
        .list { display: flex; position: absolute; left: 0; height: 100%; transition: transform 6s cubic-bezier(0.1, 0, 0.1, 1); }
        .card { min-width: 120px; height: 160px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-right: 1px solid #161b22; font-size: 40px; }
        
        .rarity-common { color: #8b949e; }
        .rarity-rare { color: #58a6ff; text-shadow: 0 0 10px #58a6ff55; }
        .rarity-legend { color: #d29922; text-shadow: 0 0 15px #d2992288; }
    </style>
</head>
<body>

    <div id="shop-ui" class="p-4">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-bold italic tracking-tighter">STARCASE <span class="text-yellow-500">MINT</span></h1>
            <div class="bg-slate-900 border border-yellow-500/40 px-3 py-1 rounded-full text-sm">
                ‚≠ê <span id="user-balance">1,250</span>
            </div>
        </div>

        <div id="cases-list">
            <div class="case-item p-4 flex items-center justify-between" onclick="initSpin('Standard')">
                <div class="flex items-center gap-4">
                    <div class="text-4xl">üì¶</div>
                    <div>
                        <div class="font-bold text-gray-200">Standard Case</div>
                        <div class="text-[10px] text-gray-500 uppercase">RTP 70% ‚Ä¢ WIN UP TO 1000</div>
                    </div>
                </div>
                <div class="bg-yellow-500 text-black font-black px-3 py-1.5 rounded-lg text-xs">100 ‚≠ê</div>
            </div>

            <div class="case-item p-4 flex items-center justify-between border-blue-500/20" onclick="initSpin('Rare')">
                <div class="flex items-center gap-4">
                    <div class="text-4xl">üíé</div>
                    <div>
                        <div class="font-bold text-blue-400">Rare Chest</div>
                        <div class="text-[10px] text-gray-500 uppercase">RTP 70% ‚Ä¢ WIN UP TO 5000</div>
                    </div>
                </div>
                <div class="bg-blue-600 text-white font-black px-3 py-1.5 rounded-lg text-xs">500 ‚≠ê</div>
            </div>
        </div>
    </div>

    <div id="roulette-overlay">
        <div class="text-center mt-10">
            <div id="status-text" class="text-yellow-500 font-black italic text-xl animate-pulse">–û–¢–ö–†–´–í–ê–ï–ú...</div>
        </div>
        
        <div class="window">
            <div class="pointer"></div>
            <div id="card-list" class="list"></div>
        </div>

        <div class="text-center mt-10 p-6">
            <div class="text-gray-500 text-xs tracking-widest uppercase">–¢–≤–æ–π –≤—ã–∏–≥—Ä—ã—à –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É–¥–∞—á–∏</div>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–∑–æ–≤ –¥–ª—è RTP 70%
        const CONFIG = {
            'Standard': {
                price: 100,
                items: [
                    {img: 'üí©', val: '10 ‚≠ê', rarity: 'common', chance: 40},
                    {img: 'ü™ô', val: '50 ‚≠ê', rarity: 'common', chance: 35},
                    {img: 'üíé', val: '200 ‚≠ê', rarity: 'rare', chance: 20},
                    {img: 'üèÜ', val: '1000 ‚≠ê', rarity: 'legend', chance: 5}
                ]
            },
            'Rare': {
                price: 500,
                items: [
                    {img: 'ü™ô', val: '50 ‚≠ê', rarity: 'common', chance: 45},
                    {img: 'üíé', val: '300 ‚≠ê', rarity: 'rare', chance: 35},
                    {img: 'üîã', val: '1000 ‚≠ê', rarity: 'rare', chance: 15},
                    {img: 'üëë', val: '5000 ‚≠ê', rarity: 'legend', chance: 5}
                ]
            }
        };

        function initSpin(caseType) {
            const data = CONFIG[caseType];
            
            tg.showConfirm(`–û—Ç–∫—Ä—ã—Ç—å ${caseType} –∑–∞ ${data.price} ‚≠ê?`, (isConfirmed) => {
                if (isConfirmed) {
                    runRoulette(data.items);
                }
            });
        }

        function runRoulette(items) {
            const overlay = document.getElementById('roulette-overlay');
            const list = document.getElementById('card-list');
            
            overlay.style.display = 'block';
            list.innerHTML = '';
            
            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–µ–Ω—Ç—É
            let pool = [];
            for (let i = 0; i < 70; i++) {
                const rand = Math.random() * 100;
                let sum = 0;
                let win;
                for (let itm of items) {
                    sum += itm.chance;
                    if (rand <= sum) { win = itm; break; }
                }
                pool.push(win);
                
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = <div>${win.img}</div><div class="text-[10px] mt-2 font-bold ${'rarity-'+win.rarity}">${win.val}</div>;
                list.appendChild(card);
            }

            // –ê–Ω–∏–º–∞—Ü–∏—è
            const cardWidth = 121;
            const targetIndex = 65;
            const offset = (window.innerWidth / 2) - (cardWidth / 2);
            const finalX = (targetIndex * cardWidth) - offset;

            setTimeout(() => {
                list.style.transform = translateX(-${finalX}px);
                
                // –í–∏–±—Ä–æ-–æ—Ç–∫–ª–∏–∫ "–¢–∏–∫–∞–Ω—å–µ"
                let ticks = 0;
                const ticker = setInterval(() => {
                    tg.HapticFeedback.impactOccurred('light');
                    ticks++;
                    if(ticks > 50) clearInterval(ticker);
                }, 110);
            }, 100);

            // –†–µ–∑—É–ª—å—Ç–∞—Ç
            setTimeout(() => {
                const winner = pool[targetIndex];
                tg.HapticFeedback.notificationOccurred('success');
                
                tg.showPopup({
                    title: 'üéâ –ü–û–ë–ï–î–ê!',
                    message: –¢–≤–æ–π –≤—ã–∏–≥—Ä—ã—à: ${winner.val},
                    buttons: [{type: 'ok', text: '–ó–ê–ë–†–ê–¢–¨'}]
                }, () => {
                    location.reload();
                });
            }, 6500);
        }
    </script>
</body>
</html>
